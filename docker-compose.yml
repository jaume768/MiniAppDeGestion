services:
  db:
    image: mysql:8.0
    container_name: mysql-gestion
    environment:
      MYSQL_ROOT_PASSWORD: root_pass123     # contrase침a de root
      MYSQL_DATABASE: gestion_empresa      # base de datos que se crear치
      MYSQL_USER: gestion_user             # usuario no-root
      MYSQL_PASSWORD: gestion_pass123      # contrase침a de ese usuario
    ports:
      - "3307:3306"                      # mapeo de puerto para acceder desde tu host
    volumes:
      - mysql_data:/var/lib/mysql          # volumen persistente
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "gestion_user", "-pgestion_pass123"]
      interval: 10s
      timeout: 5s
      retries: 5
  
  api:
    build:
      context: ./api_gestion_empresa
      dockerfile: Dockerfile
    container_name: api-gestion
    command: sh -c "chmod +x entrypoint.sh && ./entrypoint.sh python manage.py runserver 0.0.0.0:8000"
    volumes:
      - ./api_gestion_empresa:/app         # hot reload: cualquier cambio en el c칩digo se refleja inmediatamente
    ports:
      - "8000:8000"
    depends_on:
      - db
    environment:
      - DEBUG=1
      - DATABASE_HOST=db
      - DATABASE_NAME=gestion_empresa
      - DATABASE_USER=gestion_user
      - DATABASE_PASSWORD=gestion_pass123

volumes:
  mysql_data:
